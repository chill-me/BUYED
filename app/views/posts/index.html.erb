<div class="posts-layout">
   <div class="container">
       <% @posts.each do |post| %>
            <div class="posts-main-container">
                <img class="user-icon" src="/default-user-icon.png">
                    <div class="user-name"><%= post.user.name %></div>
                         <div class="img-container" data-target="#img-modal<%= post.id %>">
                            <img class="item-img" src=<%="/post_images/#{post.post_imgname}"%> >
                           <!-- 
                           <div id="img-mask <%= post.id %>" class="img-mask">
                                <d class="caption">
                                    <p>date:</p>
                                    <p>item-name：<%= post.item_name =%></p>
                                    <p>price：<%= post.price %></p>
                                    <p>satisfaction:</p>
                                </d iv>
                            </div> 
                            -->
                        </div>
            </div>
<!----------------------modaここから---------------------->
                <div id="img-modal<%= post.id %>" class="modal">
                    <div class="modal-content">
                        <div class="modal-body">
                        <!--modal left-->
                            <div class="modal-left-info">
                                <img class="modal-img" src=<%="/post_images/#{post.post_imgname}"%>>
                            </div>
                        <!--modal right-->
                                <div class="modal-right-info">
                                        <div class="left-section">
                                            <img class="mo-user-icon" src="/default-user-icon.png">
                                            <div class="mo-user-name"><%= post.user.name %></div>
                                            <span class="follow">フォローする</span>
                                        </div>
                                        <div class="right-section">
                                            <div class="mo-someicon">
                                                <i class="fas fa-pencil-alt fa-2x"></i>
                                                <i class="fas fa-comment fa-2x"></i>
                                                <i class="fas fa-heart fa-2x"></i>
                                            </div>
                                        </div>
                        <!--info-->
                                        <div class="mo-main-infocontainer">
                                            <p><i class="far fa-clock"></i><%= post.created_at =%></p>
                                            <p><i class="fa fa-shopping-bag"></i><%= post.item_name =%></p>
                                            <p><i class="far fa-clock"></i><%= post.price %></p>
                                            <p><i class="far fa-clock"></i></p>
                                            <p><i class="far fa-clock"></i></p>

                                        </div>
                                </div>
                        </div>
                    </div>
                </div>
<!----------------------modaここまで---------------------->

        <% end %>
    </div>
</div>

<script>

$('.img-container').click(function(e) {
    $($(this).data('target')).fadeIn();
    console.log("click on");
    e.stopPropagation();
});

$(document).on('click', function(e) {
    if (!$(e.target).closest($('.modal-content')).length) {
        console.log("out of modal");
        $('.modal').fadeOut();
    }else{
        console.log("in modal");
    };
});

document.onkeyup = function (e) {
    e = e || window.event;
    if(e.keyCode === 27) $('.modal').fadeOut();
};

// -----------------------------------------------------------------
// $(document).on('turbolinks:load', function() {
// $('.img_container').hover(
//     function() {
//     $($(this).data('target')).css('visibility','visible');
//     console.log("mouse over now");
// },
//     function() {
//     $($(this).data('target')).css("visibility","hidden");
//     console.log("mouse move out now");
//  });
// });
// -----------------------------------------------------------------
</script>
